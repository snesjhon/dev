---
interface Props {
  images: string[];
  alt: string;
}

const { images, alt } = Astro.props;
const id = `carousel-${Math.random().toString(36).slice(2, 9)}`;
---

<div class="relative" id={id}>
  <div class="overflow-hidden rounded-md ">
    {images.map((img, i) => (
      <img
        src={`/images/${img}`}
        alt={`${alt} screenshot ${i + 1}`}
        class="carousel-slide w-full"
        data-index={i}
        style={i === 0 ? '' : 'display: none;'}
      />
    ))}
  </div>

  {images.length > 1 && (
    <>
      <button
        class="carousel-prev absolute left-2 top-1/2 -translate-y-1/2 bg-gh-canvas-default/80 border border-gh-border-default rounded-full p-1.5 hover:bg-gh-canvas-subtle transition-colors"
        aria-label="Previous image"
      >
        <svg class="w-4 h-4 text-gh-fg-default" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5" />
        </svg>
      </button>
      <button
        class="carousel-next absolute right-2 top-1/2 -translate-y-1/2 bg-gh-canvas-default/80 border border-gh-border-default rounded-full p-1.5 hover:bg-gh-canvas-subtle transition-colors"
        aria-label="Next image"
      >
        <svg class="w-4 h-4 text-gh-fg-default" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" />
        </svg>
      </button>
      <div class="flex justify-center gap-1.5 mt-3">
        {images.map((_, i) => (
          <button
            class="carousel-dot w-2 h-2 rounded-full transition-colors"
            data-index={i}
            aria-label={`Go to image ${i + 1}`}
          />
        ))}
      </div>
    </>
  )}
</div>

<script>
  document.querySelectorAll('[id^="carousel-"]').forEach(carousel => {
    const slides = carousel.querySelectorAll<HTMLImageElement>('.carousel-slide');
    const dots = carousel.querySelectorAll<HTMLButtonElement>('.carousel-dot');
    const prevBtn = carousel.querySelector('.carousel-prev');
    const nextBtn = carousel.querySelector('.carousel-next');
    let current = 0;

    function show(index: number) {
      slides.forEach(s => (s.style.display = 'none'));
      dots.forEach(d => {
        d.classList.remove('bg-gh-accent-emphasis');
        d.classList.add('bg-gh-border-default');
      });
      slides[index].style.display = 'block';
      dots[index]?.classList.remove('bg-gh-border-default');
      dots[index]?.classList.add('bg-gh-accent-emphasis');
      current = index;
    }

    show(0);

    prevBtn?.addEventListener('click', () => {
      show((current - 1 + slides.length) % slides.length);
    });

    nextBtn?.addEventListener('click', () => {
      show((current + 1) % slides.length);
    });

    dots.forEach(dot => {
      dot.addEventListener('click', () => {
        show(Number(dot.dataset.index));
      });
    });
  });
</script>
